local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = game:GetService("Workspace").CurrentCamera

local function createLabel(player)
    local Head = player.Character:WaitForChild("Head", 3)
    if not Head then return end

    local DistanceLabel = Instance.new("BillboardGui")
    DistanceLabel.Size = UDim2.new(0, 200, 0, 50)
    DistanceLabel.StudsOffset = Vector3.new(0, 3, 0)
    DistanceLabel.Adornee = Head
    DistanceLabel.Name = "DistanceLabel"
    DistanceLabel.AlwaysOnTop = true

    local TextLabel = Instance.new("TextLabel")
    TextLabel.Parent = DistanceLabel
    TextLabel.Size = UDim2.new(1, 0, 1, 0)
    TextLabel.BackgroundTransparency = 1
    TextLabel.Text = ""
    TextLabel.TextSize = 18
    TextLabel.TextColor3 = Color3.new(255, 255, 255) -- Red color
    TextLabel.Font = Enum.Font.SourceSansBold

    local function updateLabel()
        if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then
            DistanceLabel:Destroy()
            return
        end

        local distance = (player.Character.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).magnitude
        TextLabel.Text = player.Name .. "\nDistance: " .. tostring(math.floor(distance)) .. " studs"
    end

    player.CharacterAdded:Connect(function()
        Head = player.Character:WaitForChild("Head")
        updateLabel()
    end)

    player.CharacterRemoving:Connect(function()
        DistanceLabel:Destroy()
    end)

    updateLabel()
    DistanceLabel.Parent = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")

    -- Update the label every 0.1 seconds
    spawn(function()
        while wait(0.1) do
            updateLabel()
        end
    end)
end

local function onPlayerAdded(player)
    if player == LocalPlayer then return end
    createLabel(player)
end

local function onPlayerRemoving(player)
    local gui = LocalPlayer.PlayerGui:FindFirstChild(player.Name)
    if gui then
        gui:Destroy()
    end
end

Players.PlayerAdded:Connect(onPlayerAdded)
Players.PlayerRemoving:Connect(onPlayerRemoving)

for _, player in ipairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        createLabel(player)
    end
end
